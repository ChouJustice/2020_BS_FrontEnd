<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <title>Hello, world!</title>

  <style>
    * {
      padding: 0;
      margin: 0;
      list-style: none;
    }

    #puzzle-area * {
      vertical-align: bottom;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-12 col-md-6">
        <div id="puzzle-area">
          <!-- 拼圖 -->
          <!-- <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas>
          <canvas></canvas> -->
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div>
          <!-- 控制區 -->
          <button type="button" name="" id="startBtn" class="btn btn-primary">打亂</button>
          <button type="button" name="" id="" class="btn btn-primary">開始</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    //拼圖設定
    //---1. 設定原始圖
    var puzzleImg = new Image();
    puzzleImg.src = './star_540.jpg';
    var whiteImg = new Image();
    whiteImg.src = './white.png';

    //---2. 生成切片
    //var puzzleItems = document.querySelectorAll('#puzzle-area canvas');
    //console.log(puzzleItems);

    //---取得父元素
    var puzzleArea = document.getElementById('puzzle-area');

    //---設定幾乘幾
    let imgBase = 3

    puzzleImg.onload = function () {
      let pWidth = puzzleImg.width / imgBase;
      let pHeight = puzzleImg.height / imgBase;

      for (let i = 0; i < imgBase; i++) {
        for (let j = 0; j < imgBase; j++) {
          let canvas = document.createElement('canvas');
          canvas.width = puzzleImg.width / imgBase;
          canvas.height = puzzleImg.height / imgBase;
          canvasContent = canvas.getContext("2d");
          if (i == 0 && j == 0) //我先寫死
          {
            canvasContent.drawImage(whiteImg, j * pWidth, i * pHeight, pWidth, pHeight, 0, 0, pWidth, pHeight);
            canvas.setAttribute('class', 'white');
          } else {
            canvasContent.drawImage(puzzleImg, j * pWidth, i * pHeight, pWidth, pHeight, 0, 0, pWidth, pHeight);
            canvas.setAttribute('class', 'moveable');
          }
          puzzleArea.appendChild(canvas);
        }
      }
    }

    //window onload ?? (當圖都長完才抓得到canvas)
    window.onload = function () {
      var canvasBlocks = document.getElementsByTagName('.moveable');
      console.log(canvasBlocks);

      for (let block of canvasBlocks) {
        block.addEventListener('click', function () {
          //判斷是否可以被移動
          //--1.判斷自己是否在白色塊上下左右???
          
          //移動方法
          //--1.白色塊與自己交換'位置'

          //判斷輸贏
        });
      }

    }
    // for(let item of puzzleItems)
    // {
    //   item.width = 500;
    //   item.height = 500;

    //   let cxt = item.getContext("2d");

    //   console.log(cxt);
    //   //cxt.clearRect(0, 0, 100, 100);
    //   cxt.drawImage(puzzleImg, 0, 0);
    // }

  </script>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
</body>

</html>
